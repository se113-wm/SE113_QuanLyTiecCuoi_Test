<Window
    x:Class="QuanLyTiecCuoi.Presentation.View.InvoiceView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converter="clr-namespace:QuanLyTiecCuoi.Presentation.Helpers"
    xmlns:helper="clr-namespace:QuanLyTiecCuoi.BusinessLogicLayer.Helpers"
    xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
    xmlns:local="clr-namespace:QuanLyTiecCuoi.Presentation.ViewModel"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    Name="HoaDon"
    Title="Hóa Đơn"
    Width="1000"
    Height="820"
    Icon="Assets/icon_invoice.ico"
    WindowStartupLocation="CenterScreen">
    <Window.Resources>
        <converter:MultiplyConverter x:Key="MultiplyConverter" />
    </Window.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Disabled">
        <Grid>
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!--  Ten hoa don  -->
                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <!--  Centered Invoice Title and ID  -->
                    <StackPanel
                        Grid.Column="1"
                        HorizontalAlignment="Center"
                        Orientation="Horizontal">
                        <TextBlock
                            FontSize="24"
                            FontWeight="Bold"
                            Text="HOÁ ĐƠN " />
                        <TextBlock
                            FontSize="24"
                            FontWeight="Bold"
                            Text="{Binding InvoiceId}" />
                    </StackPanel>

                    <!--  Status on the right with colored border  -->
                    <Border
                        Grid.Column="2"
                        Margin="0,0,10,0"
                        Padding="8,2"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        BorderBrush="{Binding SelectedInvoice.TrangThaiBrush}"
                        BorderThickness="2"
                        CornerRadius="6">
                        <TextBlock
                            VerticalAlignment="Center"
                            FontSize="20"
                            FontWeight="Bold"
                            Foreground="{Binding SelectedInvoice.TrangThaiBrush}"
                            Text="{Binding SelectedInvoice.TrangThai}"
                            TextAlignment="Center" />
                    </Border>
                </Grid>

                <!--  Chi tiet tiec cuoi  -->
                <materialDesign:Card
                    Grid.Row="1"
                    Margin="0,0,0,10"
                    Padding="10"
                    BorderThickness="0.5">
                    <StackPanel>
                        <StackPanel VerticalAlignment="Center" Orientation="Horizontal">
                            <TextBlock
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Chi tiết tiệc cưới" />
                        </StackPanel>

                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="2*" />
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="2*" />
                                <RowDefinition Height="2*" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <TextBox
                                Grid.Row="0"
                                Grid.Column="0"
                                Margin="5"
                                materialDesign:HintAssist.Hint="Tên chú rễ"
                                IsReadOnly="True"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                Text="{Binding SelectedInvoice.TenChuRe, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBox
                                Grid.Row="0"
                                Grid.Column="1"
                                Margin="5"
                                materialDesign:HintAssist.Hint="Tên cô dâu"
                                IsReadOnly="True"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                Text="{Binding SelectedInvoice.TenCoDau, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBox
                                Grid.Row="0"
                                Grid.Column="2"
                                Margin="5"
                                materialDesign:HintAssist.Hint="Ngày thanh toán"
                                IsReadOnly="true"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                Text="{Binding PaymentDate, StringFormat={}{0:dd/MM/yyyy}, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBox
                                Grid.Row="1"
                                Grid.Column="0"
                                Margin="5"
                                materialDesign:HintAssist.Hint="Số lượng bàn"
                                IsReadOnly="{Binding IsPaid}"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                Text="{Binding TableQuantity, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                            <StackPanel
                                Grid.Row="2"
                                Grid.Column="0"
                                Margin="5"
                                Orientation="Vertical">
                                <TextBlock
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Margin="5"
                                    FontSize="10"
                                    Text="{Binding TableQuantityMessage}" />
                                <TextBlock
                                    Grid.Row="3"
                                    Grid.Column="0"
                                    Margin="5"
                                    FontSize="10"
                                    Text="{Binding TableQuantityMax}" />
                            </StackPanel>
                            <TextBox
                                Grid.Row="1"
                                Grid.Column="1"
                                Margin="5"
                                materialDesign:HintAssist.Hint="Đơn giá bàn"
                                IsReadOnly="True"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                                Text="{Binding DonGiaBan, Converter={StaticResource CurrencyFormatConverter}, UpdateSourceTrigger=PropertyChanged}" />
                            <TextBox
                                Grid.Row="1"
                                Grid.Column="2"
                                Margin="5"
                                materialDesign:HintAssist.Hint="Tổng tiền bàn"
                                IsReadOnly="True"
                                Style="{StaticResource MaterialDesignFloatingHintTextBox}">
                                <TextBox.Text>
                                    <MultiBinding
                                        Converter="{StaticResource MultiplyConverter}"
                                        FallbackValue="0"
                                        NotifyOnValidationError="False"
                                        TargetNullValue="0"
                                        UpdateSourceTrigger="PropertyChanged"
                                        ValidatesOnExceptions="False">
                                        <Binding Path="TableQuantity" />
                                        <Binding Path="DonGiaBan" />
                                    </MultiBinding>
                                </TextBox.Text>
                            </TextBox>
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>

                <!--  Danh sach dich vu  -->
                <materialDesign:Card
                    Grid.Row="2"
                    Margin="0,0,0,10"
                    Padding="5"
                    VerticalAlignment="Stretch"
                    BorderThickness="0.5">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <TextBlock
                            Grid.Row="0"
                            FontSize="16"
                            FontWeight="Bold"
                            Text="Danh sách dịch vụ" />

                        <ListView
                            Grid.Row="1"
                            Margin="0"
                            VerticalAlignment="Stretch"
                            HorizontalContentAlignment="Left"
                            AlternationCount="1000"
                            ItemsSource="{Binding ServiceList}">
                            <ListView.View>
                                <GridView>
                                    <!--  Index  -->
                                    <GridViewColumn Width="90" Header="STT">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock
                                                    Margin="20,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    Text="{Binding RelativeSource={RelativeSource AncestorType=ListViewItem}, Path=(ItemsControl.AlternationIndex), Converter={StaticResource AddConverter}, ConverterParameter=1}"
                                                    TextAlignment="Left" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <!--  Name  -->
                                    <GridViewColumn Width="150" Header="Tên dịch vụ">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock
                                                    Margin="20,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    Text="{Binding DichVu.TenDichVu}"
                                                    TextAlignment="Left" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <!--  Price  -->
                                    <GridViewColumn Width="150" Header="Đơn giá">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock
                                                    Margin="20,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    Text="{Binding DonGia, Converter={StaticResource CurrencyFormatConverter}, StringFormat={}{0:N0}}"
                                                    TextAlignment="Left" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <!--  Quantity  -->
                                    <GridViewColumn Width="150" Header="Số lượng">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock
                                                    Margin="20,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    Text="{Binding SoLuong}"
                                                    TextAlignment="Left" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                    <!--  Note  -->
                                    <GridViewColumn Width="Auto" Header="Ghi chú">
                                        <GridViewColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock
                                                    Margin="20,0,0,0"
                                                    HorizontalAlignment="Left"
                                                    Text="{Binding GhiChu}"
                                                    TextAlignment="Left" />
                                            </DataTemplate>
                                        </GridViewColumn.CellTemplate>
                                    </GridViewColumn>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </materialDesign:Card>

                <!--  Tien  -->
                <materialDesign:Card
                    Grid.Row="3"
                    Padding="10"
                    VerticalAlignment="Stretch"
                    BorderThickness="0.5">
                    <StackPanel Orientation="Vertical">
                        <!--  Tổng tiền dịch vụ  -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Tổng tiền dịch vụ:" />
                            <TextBox
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Stretch"
                                FontSize="16"
                                IsReadOnly="True"
                                Text="{Binding SelectedInvoice.TongTienDV, Converter={StaticResource CurrencyFormatConverter}}" />
                        </Grid>
                        <Border
                            Height="1"
                            Margin="0,5"
                            Background="Gray" />

                        <!--  Chi phí thiết bị hỏng hóc  -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Chi phí thiết bị hỏng hóc trong tiệc:" />
                            <TextBox
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Stretch"
                                FontSize="16"
                                IsReadOnly="{Binding IsPaid}">
                                <TextBox.Text>
                                    <Binding
                                        Converter="{StaticResource CurrencyFormatConverter}"
                                        Mode="TwoWay"
                                        Path="DamageEquipmentCost"
                                        UpdateSourceTrigger="PropertyChanged">
                                        <Binding.ValidationRules>
                                            <converter:DecimalValidationRule />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </TextBox.Text>
                            </TextBox>
                        </Grid>
                        <Border
                            Height="1"
                            Margin="0,5"
                            Background="Gray" />
                        <!--  Tổng tiền hóa đơn  -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Tổng tiền hóa đơn:" />
                            <TextBox
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Stretch"
                                FontSize="16"
                                IsReadOnly="True"
                                Text="{Binding TotalInvoiceAmount, Converter={StaticResource CurrencyFormatConverter}, UpdateSourceTrigger=PropertyChanged}" />
                        </Grid>
                        <Border
                            Height="1"
                            Margin="0,5"
                            Background="Gray" />
                        <!--  Tien phat  -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Tiền phạt (thanh toán trễ):" />
                            <TextBox
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Stretch"
                                FontSize="16"
                                IsReadOnly="True"
                                Text="{Binding Fine, Converter={StaticResource CurrencyFormatConverter}, UpdateSourceTrigger=PropertyChanged}" />
                        </Grid>
                        <Border
                            Height="1"
                            Margin="0,5"
                            Background="Gray" />
                        <!--  Tiền đặt cọc  -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Tiền đặt cọc:" />
                            <TextBox
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Stretch"
                                FontSize="16"
                                IsReadOnly="True"
                                Text="{Binding Deposit, Mode=TwoWay, Converter={StaticResource CurrencyFormatConverter}, UpdateSourceTrigger=PropertyChanged}" />
                        </Grid>
                        <Border
                            Height="1"
                            Margin="0,5"
                            Background="Gray" />
                        <!--  Còn lại  -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <TextBlock
                                VerticalAlignment="Center"
                                FontSize="16"
                                FontWeight="Bold"
                                Text="Còn lại:" />
                            <TextBox
                                Grid.Column="1"
                                Margin="10,0,0,0"
                                HorizontalAlignment="Stretch"
                                FontSize="16"
                                IsReadOnly="True"
                                Text="{Binding RemainingAmount, Mode=OneWay, Converter={StaticResource CurrencyFormatConverter}}" />
                        </Grid>
                        <Border
                            Height="1"
                            Margin="0,5"
                            Background="Gray" />
                        <Grid Margin="0,20,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <StackPanel Grid.Row="0" Orientation="Vertical">
                                <Button
                                    Grid.Column="0"
                                    Width="180"
                                    Margin="0,0,10,0"
                                    Command="{Binding ConfirmPaymentCommand}"
                                    CommandParameter="{Binding RelativeSource={RelativeSource AncestorType=Window}}"
                                    Content="{Binding PaymentText, UpdateSourceTrigger=PropertyChanged}"
                                    Style="{StaticResource MaterialDesignRaisedButton}" />
                                <TextBlock
                                    Grid.Row="2"
                                    Grid.Column="0"
                                    Margin="5"
                                    HorizontalAlignment="Center"
                                    FontSize="10"
                                    Foreground="Gray"
                                    Text="{Binding ConfirmMessage, UpdateSourceTrigger=PropertyChanged}" />
                            </StackPanel>
                            <Button
                                Grid.Column="2"
                                Width="120"
                                VerticalAlignment="Top"
                                Command="{Binding ExportCommand}"
                                Content="Xuất PDF"
                                Style="{StaticResource MaterialDesignRaisedButton}" />
                        </Grid>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>
        </Grid>
    </ScrollViewer>
</Window>

